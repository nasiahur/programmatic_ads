{% extends 'squid/cache/index.html' %}

{% block toolbar_disk %}class="active"{%endblock%}
{% block page_comment %}{% endblock %}

{% block page_content %}

    <style type="text/css">
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance:textfield;
        }
    </style>


    <div class="box">


        <div class="alert alert-error">
            <p><strong>WARNING: you are going to delete and reset the cache folder <em>{{disk_cache.cache_dir}}</em>. This is irreversible operation and cannot be undone!</strong></p>

            <p>Please type <em>I confirm</em> in the field below and click the <em>Erase Cache Dir</em> button. After that the following sequence of events will occur:</p>
            <ol>
                <li>Squid proxy will be stopped, HTTP(S) access to the Internet will be interrupted for all proxy users.</li>
                <li>Disk cache will be enabled.</li>
                <li>Cache structure on disk will be regenerated by running <em>squid -z</em>.
                <li>Squid proxy will be started.</li>
            </ol>

            <p style="margin-bottom: 0px;">On existing large caches re-initialize may take a lot of time and browser will timeout. In this case it is recommended to remove the cache dir from root console by stopping Squid manually and then running <em>rm -Rf {{disk_cache.cache_dir}}</em>. Once removal finishes, re-initialize the cache dir using this page.</p>
        </div>


        {% block member_heading%}{%endblock%}

        {% if form.non_field_errors %}
        <div class="alert alert-error">
            <p><strong>FATAL ERROR!</strong></p>
            <p>It is recommended to remove the cache dir from root console by stopping Squid manually and then running <em>rm -Rf {{disk_cache.cache_dir}}</em>. Once removal finishes, re-initialize the cache dir using this page. In case it fails again, contact support@diladele.com.</p>
            
             {% for error in form.non_field_errors %}
                 <span><pre>{{ error|escape }}</pre></span>
             {% endfor %}

        </div>  
        {% endif %}

        <form class="form-horizontal" method="POST">
            {% csrf_token %}
            <div class="control-group {% if form.confirm.errors %}error{%endif%}">
                <label class="control-label" for="id_confirm">&nbsp;</label>
                <div class="controls">
                    <style>#id_confirm { width: 120px; }</style>
                    {{form.confirm}}
                    {% if form.confirm.errors %}
                        <span class="help-block">{{form.confirm.errors|striptags}}</span>
                    {% else %}
                        <span class="help-block">Type <em>I confirm</em> to erase and reinitialize Squid cache directory.</span>
                    {%endif%}
                </div>
            </div>
            <div class="control-group">
                <div class="controls">
                    <div class="btn-group"><button type="submit" class="btn btn-danger">Erase Cache Dir</button></div>
                </div>
            </div>
        </form>

        

    </div>
    
{% endblock %}