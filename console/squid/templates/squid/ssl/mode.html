{% extends 'squid/ssl/index.html' %}

{% block toolbar_ssl_mode %}class="active"{%endblock%}

{% block page_comment %}{% endblock %}


{% block page_content %}


	<section class="container">
		<div class="box">
			<section class="row-fluid">			
				<p>This page is used to enable and configure HTTPS filtering (SSLBump). By default HTTPS filtering is disabled. Please contact your lawyer before enabling this feature. It might be considered illegal in some countries. See <a target="_new" href="http://wiki.squid-cache.org/Features/SslBump">Squid Wiki for more information</a>.
			</section>
			<section class="row-fluid" style="margin-top: 10px;">			
				<form method="POST" action="{% url 'ViewSslMode' %}">
				{% csrf_token %}
			    <section class="row-fluid">
			        <div class="span6">            
			            <button class="btn btn-block btn-large{% if bumpmode.value == 1 %} btn-primary{% endif %}" type="submit" name="bump_all" value="1">Filter all HTTPS connections by default</button>
			        </div>
			        <div class="span6">
			            <button class="btn btn-block btn-large{% if not bumpmode.value == 1 %} btn-primary{% endif %}" type="submit" name="bump_all" value="0">Filter HTTPS connections to specific domains only</button>
			        </div>        
			    </section>
			    </form>
			</section>
			<section class="row-fluid">			
				<div class="span12">
					<p>Filtering mode specifies how Squid will decrypt the HTTPS/SSL connections. It is possible to decrypt connections to all sites (with exclusions) or only decrypt connections to sites specified in <a href="{% url 'ViewSslTargetDomainList' %}">Target Domains</a> tab and leave everything else intact.</p>
				</div>
			</section>
		</div>

		<section class="row-fluid">
			<h3 class="box-header">Trusted Root CA Certificates</h3>
			<div class="box">

				{% if cert.DefaultDiladeleKey %}
				<section class="row-fluid">
				    <div class="alert alert-error">
				    	<p><strong>ATTENTION: YOU ARE USING DEFAULT ROOT CERTIFICATE FOR HTTPS DECRYPTION!</strong></p>
				        <p>You are strongly advised to generate your own certificate instead of the default one. Default certificate is distributed with all installations of Web Safety and trusting it may compromise your network. It also poses serious security risk outside of your network. Click <em>Generate New Certificate</em> button below and follow the wizard to regenerate proxy certificate. The <a target="_new" href="https://docs.diladele.com/administrator_guide_6_1/https_filtering/generate_certificates/manually.html">Online Documentation</a> shows how to do it manually if required.</p>
				    </div>
				</section>
				{% endif %}

				<section class="row-fluid">
					<p>Web filtering of encrypted HTTPS/SSL connections is only possible when browsers are set to trust mimicked site certificates generated by Squid. The <a target="_new" href="https://docs.diladele.com/administrator_guide_6_1/https_filtering/install_certificates/index.html">online documentation</a> describes how to install proxy certificate into Trusted Root Certification Authority store and get rid of warnings in the browser.</p>

					<div class="form-actions" style="padding:5px;">
				    	<a href="{% url 'ViewSslDer' %}" type="button" class="btn btn-primary">Download Certificate To Use In Browsers</a>
				    	<a href="{% url 'ViewSslPemBackUp' %}" type="button" class="btn">BackUp Current Certificate</a>
				    	<a href="{% url 'ViewSslPemUpload' %}" type="button" class="btn">Upload New Certificate</a>
				    	<a href="{% url 'ViewSslPemGenerate' %}" type="button" class="btn">Generate New Certificate</a>
    				</div>		

					<p>The following table shows properties of your current Trusted Root CA Certificate.</p>

				</section>
				<section class="row-fluid">	

					{% if not result %}
				    <div class="alert alert-error">
				    	<p><strong>ERROR</strong> cannot get details of the root certificate!</p>
				    	<pre>{{error}}</pre>
				    </div>				
					{% else %}
					<table class="table table-striped table-condensed table-hover">
				        <tbody><tr><th>Certificate Property</th><th>Value</th></tr>
				        <!-- human important -->
				        <tr>
				            <td>Country</td>
				            <td>{{cert.Country}}</td>
				        </tr>
				        <tr>
				            <td>Province</td>
				            <td>{{cert.Province}}</td>
				        </tr>
				        <tr>
				            <td>Locality</td>
				            <td>{{cert.Locality}}</td>
				        </tr>
				        <tr>
				            <td>Organization</td>
				            <td>{{cert.Organization}}</td>
				        </tr>
				        <tr>
				            <td>OrganizationalUnit</td>
				            <td>{{cert.OrganizationalUnit}}</td>
				        </tr>
				        <tr>
				            <td>CommonName</td>
				            <td>{{cert.CommonName}}</td>
				        </tr>


				        <tr>
				            <td>Version</td>
				            <td>{{cert.Version}}</td>
				        </tr>
				        <tr>
				            <td>Serial Number</td>
				            <td>{{cert.SerialNumber}}</td>
				        </tr>                
				        <tr>
				            <td>Signature Algorithm</td>
				            <td>{{cert.SignatureAlgorithm}}</td>
				        </tr> 
				        <tr>
				            <td>Valid From</td>
				            <td>{{cert.NotBefore}}</td>
				        </tr>
				        <tr>
				            <td>Valid Until</td>
				            <td>{{cert.NotAfter}}</td>
				        </tr>
				        <tr>
				            <td>Subject Key Identifier</td>
				            <td>{{cert.SubjectKeyId}}</td>
				        </tr>
				        <tr>
				            <td>Is Certificate Authority</td>
				            <td>{{cert.IsCA}}</td>
				        </tr>
				        </tbody>
				    </table>
				    {% endif %}			        
				</section>								
			</div>
		</section>		
	</section>    

    
{% endblock %}